{{ layout "includes/layout.vto" }}

<!-- Metadata -->
<meta property="og:url" content="{{ post.uid.href }}">
<meta property="og:site_name" content="{{ siteOwner.profile.name }}">
{{ if post.name }}<meta property="og:title" content="{{ post.name }}">{{ /if }}
{{ if post.summary }}
  <meta
    name="description"
    property="og:description"
    content="{{ post.summary }}"
  >
{{ /if }}
{{ for photo of post.photo }}
    <meta property="og:image" content="{{ c.var.href(photo.url) }}">
    <meta property="og:image:alt" content="{{ photo.alt }}">
{{ /for }}
{{ for video of post.video }}
    <meta property="og:video" content="{{ video.href }}">
{{ /for }}
{{ for audio of post.audio }}
    <meta property="og:audio" content="{{ audio.href }}">
{{ /for }}

<article class="h-entry">
  <header class="container padding-block-start">
    <nav>
      <a href="/" class="p-author h-card author-card unlink">
        {{ import { makeProfileSvg } from "includes/make-profile-svg.vto" }}
        <img
          src="{{ c.var.href(siteOwner.profile.photo[0]?.url ?? await makeProfileSvg(siteOwner.profile)) }}"
          alt="{{ siteOwner.profile.photo[0]?.alt }}"
          class="photo"
          style="view-transition-name: owner-pfp"
        >
        <strong class="p-name" style="view-transition-name: owner-name">
          {{ siteOwner.profile.name }}
        </strong>
        <span>{{ c.var.baseUrl }}</span>
      </a>
    </nav>
    {{ if post.name }}
      <h1 class="p-name" style="view-transition-name: post-{{ post.iid }}-name">
        {{ post.name }}
      </h1>
    {{ /if }}
    {{ if post.summary }}
      <p class="lede" style="view-transition-name: post-{{ post.iid }}-summary">
        {{ post.summary }}
      </p>
    {{ /if }}
  </header>
  <main>
    {{ include "includes/interaction-context.vto" { post } }}
    {{ for index, photo of post.photo }}
      <figure
        style="view-transition-name: post-{{ post.iid }}-photo-{{ index }}"
      >
        <img class="u-photo" src="{{ c.var.href(photo.url) }}" alt="{{ photo.alt }}">
      </figure>
    {{ /for }}
    <div
      class="e-content"
      style="view-transition-name: post-{{ post.iid }}-content"
    >
      {{- post.content?.html |> safe -}}
    </div>
  </main>
  <footer
    style="view-transition-name: post-{{ post.iid }}-footer"
  >
    <div class="<small>">
      <p>
        <a href="{{ c.var.href(post.uid) }}" class="u-url u-uid">
          <time class="dt-published" datetime="{{ post.published |> toISOString }}">
            {{ post.published.toLocaleString([
              ...(post.language ? [post.language] : []),
              ...c.var.locales,
            ]) }}
          </time>
        </a>
        {{- if post.updated -}}
          , last updated on
          <time class="dt-updated" datetime="{{ post.updated |> toISOString }}">
            {{ post.updated.toLocaleString([
              ...(post.language ? [post.language] : []),
              ...c.var.locales,
            ]) }}
          </time>
        {{ /if }}
      </p>
      <p>
        {{ for category of post.category }}
          #<span class="p-category">{{ category }}</span>
        {{ /for }}
      </p>
    </div>

    <div style="display: flex; flex-flow: row wrap; gap: 1em">
      <denizen-webaction action="reply">
        <button>Reply</button>
      </denizen-webaction>
      {{ if admin }}
        <form action="/.denizen/post/edit" class="contents">
          <input
            type="hidden"
            name="post"
            value="{{ post.uid?.pathname }}"
          />
          <button>Edit</button>
        </form>
        <form
          rel="swap-after"
          method="DELETE"
          action="{{ post.uid?.pathname }}"
          class="contents"
        >
          <button>Delete</button>
        </form>
      {{ /if }}
    </div>

    {{ include "includes/webmentions.vto" { ...webmentions } }}
  </footer>
</article>

{{ /layout }}
